<!DOCTYPE html>
<html>
<head>
    <title>UTForum安装</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="<{$appurl}>/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="<{$appurl}>/assets/css/fontawesome.min.css">
    <script src="<{$appurl}>/assets/js/jquery.min.js"></script>
    <script src="<{$appurl}>/assets/js/bootstrap.min.js"></script>
    <style>
    body{font-size:0.8rem;}
    a{color:black;text-decoration:underline;}
    p{margin-bottom:0rem;font-size:14px;}
    .fontsmall{font-size:12px;}
    #license p{font-size:11px;
    }
    </style>
</head>
<body>
<div class="container">
    <div class="row m-b-md">
           <div class="col-md-12 mt-3 mb-3"><img src="<{$appurl}>/assets/logo.png"></div>
           <div class="col-md-12">
              <div class="border p-4">
                <{if empty($do)}>
                    <div>
                    <form name="license" action="?do=config" method="post">
                    <p class="mb-2">
                        <b>基于以下协议，本软件是免费且开源的软件。所有自然人或团体组织请在所在国法律允许范围内合法使用本软件。</b>
                    </p>
                    <p class="mb-2">
                        文书1：<a target="_blank" href="//www.apache.org/licenses/LICENSE-2.0">UTForum基于Apache2.0授权，可以通过//www.apache.org/licenses/LICENSE-2.0了解或下载到详尽的协议内容。</a>
                    </p>
                    <p class="mb-2">
                        文书2：<a target="_blank" href="//github.com/usualtool/ut-forum/blob/master/LICENSE.ADD">UTForum遵循UT开源与免费协议，任何自然人与团体组织在协议约定的范围内均可免费使用。使用人应当阅读UT序言中关于文书的部分，往此去：//github.com/usualtool/ut-cms/blob/master/LICENSE.ADD。</a>
                    </p>
                    <p class="mb-3">
                        <b>你需要仔细阅读以上2份文书，在理解和同意的前提下，方可使用本软件。</b><br/><br/>
                        <b>Made in China , github.com/usualtool/ut-forum , HuangHui</b>
                    </p>
                    <p class="mb-2">
                        <input type="submit" class="btn btn-info" value="请查阅以上文书（60）" id="btn"/> 
                    </p>
                    </form>
                    </div>
                    <script>
                        $(function(){
                            $("#btn").prop('disabled',true);
                            var time = 60;
                            timer = setInterval(function(){
                                time--;
                                if(time>=0){
                                    $("#btn").val("请查阅以上文书（"+time+"）")
                                }else{
                                    clearInterval(timer);
                                    $("#btn").prop('disabled',false);
                                    $("#btn").val("我已阅读相关文书");
                                    $("#btn").addClass('dd');
                                }
                            },1000);
                        })
                    </script>
               <{else if $do=="config"}>
               <form action="?m=ut-frame&do=db-save" method="post" name="form">
               <div class="row mb-2">
                   <div class="form-group col-md-6">
					   <p><a target="_blank" href="//frame.usualtool.com/baike/index.php?do=%E5%AE%89%E5%85%A8">生产环境安全配置建议</a></p>
                   </div>
               </div>
               <div class="row">
                  <div class="form-group col-md-6">
                     <label for="email">应用域名/IP（请带HTTP）:</label>
                     <input class="form-control" name="APPURL" id="APPURL">
                  </div>
               </div>
               <div class="row">
                  <div class="form-group col-md-6">
                     <label for="email">数据库服务器:</label>
                     <input class="form-control" name="MYSQL_HOST" id="MYSQL_HOST" value="localhost">
                  </div>
                  <div class="form-group col-md-6">
                     <label for="email">端口:</label>
                     <input class="form-control" name="MYSQL_PORT" id="MYSQL_PORT" value="3306">
                  </div>
               </div>
               <div class="row">
                  <div class="form-group col-md-6">
                     <label for="email">数据库用户:</label>
                     <input class="form-control" name="MYSQL_USER" id="MYSQL_USER">
                  </div>
                  <div class="form-group col-md-6">
                     <label for="email">数据库密码:</label>
                     <input class="form-control" name="MYSQL_PASS" id="MYSQL_PASS">
                  </div>
               </div>
               <div class="row">
                  <div class="form-group col-md-6">
                     <label for="email">数据库名称:</label>
                     <input class="form-control" name="MYSQL_DB" id="MYSQL_DB">
                  </div>
               </div>
               <div class="row">
                  <div class="col-md-6">
                  <button type="submit" class="btn btn-success">保存设置</button>
                  </div>
               </div>
               </form>
               <{else if $do=="sql"}>
                  <p>导入UTForum初始数据结构，请保持网络通畅。</p>
                  <hr/>
                  <{php=>
                  if($_GET["t"]=="db-sql"){
                     $sql=file_get_contents("../forum.sql");
                     $arr=explode(';',$sql);
                     $total=count($arr)-1;
                     $c=0;
                     for($i=0;$i<$total;$i++){
                        $k=$i+1;
                        $result=library\UsualToolData\UTData::RunSql($arr[$i]);
                        if($result){
                           echo"<p class='fontsmall'>第".$k."条SQL执行成功!</p>";
                        }else{
                           $c=$c+1;
                           echo"<p class='fontsmall' style='color:red;'>第".$k."条SQL执行失败:".$arr[$i]."</p>";
                        }
                        if($k==$total && $c==0){
                           file_put_contents("../usualtool.lock","lock");
                           library\UsualToolInc\UTInc::GoUrl("./","UTForum安装成功!");
                        }
                     }
                  }
                  }>
                  <form action="?m=ut-frame&do=sql&t=db-sql" method="post" name="form">
                  <button type="submit" class="btn btn-success">导入数据</button>
                  </form>
                  <{/if}>
              </div>
           </div>
    </div>
</div>
</body>
</html>